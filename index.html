<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scrambl</title>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-L4YDGSZDV1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-L4YDGSZDV1');
    </script>
    <style>
        /* Base styles */
        body {font-family:'Segoe UI',Roboto,Helvetica,Arial,sans-serif; max-width:600px; margin:0 auto; padding:20px; text-align:center; background-color:#121212; color:#f0f0f0; line-height:1.5;}
        /* CHANGE 1: Add gradient background to the game container */
        .game-container {
            background: linear-gradient(145deg, #212121, #2d2d2d); 
            border-radius:16px; 
            padding:24px; 
            box-shadow:0 8px 24px rgba(0,0,0,0.4); 
            transition:all 0.3s ease;
        }
        h1 {color:#fff; margin-bottom:10px; font-size:2.5em; letter-spacing:2px; font-weight:700; text-shadow:0 2px 4px rgba(0,0,0,0.2);}
        
        /* Input and buttons */
        input {padding:12px 16px; font-size:1.1em; border:none; border-radius:12px; width:65%; margin-right:10px; background-color:#333; color:#fff; box-shadow:inset 0 2px 4px rgba(0,0,0,0.1);}
        button {padding:12px 20px; background-color:#2196f3; color:white; border:none; border-radius:12px; font-size:1.1em; cursor:pointer; transition:all 0.2s ease; font-weight:600; box-shadow:0 4px 8px rgba(0,0,0,0.2);}
        button:hover {background-color:#0d8bf2; transform:translateY(-2px); box-shadow:0 6px 12px rgba(0,0,0,0.2);}
        button:active {transform:translateY(1px); box-shadow:0 2px 4px rgba(0,0,0,0.2);}
        .buttons {margin:24px 0;}
        
        /* Game elements */
        /* CHANGE 2: Improve scrambled word with letter-spacing, glowing effect and animation */
        .scrambled-word {
            font-size:2.4em; 
            font-weight:bold; 
            margin:28px 0; 
            color:#4fc3f7; 
            letter-spacing:12px; 
            text-shadow:0 0 15px rgba(79,195,247,0.5);
            animation: float 3s ease-in-out infinite;
            padding: 10px;
            background-color: rgba(33,33,33,0.5);
            border-radius: 8px;
        }
        @keyframes float {
            0% {transform: translateY(0px);}
            50% {transform: translateY(-8px);}
            100% {transform: translateY(0px);}
        }
        #message {margin:20px 0; font-weight:bold; min-height:24px; transition:all 0.3s ease;}
        #message.correct {color:#4caf50; animation:pulse 0.5s;}
        #message.incorrect {color:#f44336;}
        .score {margin-top:20px; font-weight:bold;}
        .timer {font-size:1.3em; margin-bottom:15px; color:#f44336; font-weight:bold;}
        .game-over, .game-play, .played-today {display:none;}
        .game-over {font-size:1.5em; color:#e0e0e0; margin:20px 0;}
        .final-score {font-size:1.5em; color:#4caf50; margin:20px 0;}
        #start-game {background-color:#4caf50; font-size:1.3em; padding:16px 32px; letter-spacing:1px;}
        #start-game:hover {background-color:#3d9a40;}
        .start-screen {padding:20px;}
        .countdown {font-size:1.2em; color:#f44336; margin:20px 0;}
        .daily-date {font-size:1.3em; color:#4fc3f7; margin-bottom:24px; font-weight:600;}
        .score-display {margin:15px 0; font-size:1.3em; font-weight:bold; color:#4fc3f7; background:rgba(33,150,243,0.1); padding:10px; border-radius:12px;}
        .share-score a {display:inline-block; background-color:#4caf50; color:white; padding:12px 24px; border-radius:12px; text-decoration:none; margin-top:16px; font-size:1.2em; font-weight:600; box-shadow:0 4px 8px rgba(0,0,0,0.2); transition:all 0.2s ease;}
        .share-score a:hover {background-color:#3d9a40; transform:translateY(-2px);}
        
        /* Animations */
        @keyframes pulse {
            0% {transform:scale(1);}
            50% {transform:scale(1.1);}
            100% {transform:scale(1);}
        }
        
        /* Mobile responsiveness improvements */
        @media (max-width: 480px) {
            body {padding:12px;}
            .game-container {padding:18px; border-radius:12px;}
            h1 {font-size:2.2em;}
            .scrambled-word {font-size:2em; letter-spacing:8px;}
            input {width:60%; padding:10px 14px;}
            button {padding:10px 16px;}
            .score-display {font-size:1.1em;}
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>Scrambl</h1>
        <div class="daily-date" id="daily-date"></div>

        <div class="start-screen" id="start-screen">
            <p>A new scrambl every day</p>
            <p>solve the most words in 30 seconds</p>
            <p>10 points for each letter in a word</p>
            <p>share your score - leaderboard soon</p>
            <button id="start-game">Play</button>
        </div>

        <div class="played-today" id="played-today">
            <p>Already played today.</p>
            <div class="final-score">Score: <span id="today-score">0</span></div>
            <div class="countdown" id="countdown"></div>
            <div class="share-score">
                <a id="share-link-played" href="#" target="_blank">Share</a>
            </div>
        </div>

        <div class="game-play" id="game-play">
            <div class="timer" id="timer">Time: 30s</div>
            <div class="score-display">
                <div>Words solved: <span id="words-solved">0</span> | Score: <span id="score">0</span></div>
            </div>
            <div class="scrambled-word" id="scrambled-word">RDOW</div>
            <div>
                <input type="text" id="user-guess" placeholder="Enter your answer" autocomplete="off">
                <button id="submit-btn">Submit</button>
            </div>
            <div class="buttons">
                <button id="skip-btn">Skip</button>
            </div>
            <div id="message"></div>
        </div>

        <div class="game-over" id="game-over">
            <p>Game Over</p>
            <div class="final-score" id="final-score-display"></div>
            <div class="share-score">
                <a id="share-link" href="#" target="_blank">Share</a>
            </div>
            <div class="countdown" id="countdown-end"></div>
        </div>
    </div>

    <script>
        // Analytics tracking
        const analytics = {
            // Track unique page visits
            trackPageView: function() {
                gtag('event', 'Scrambl_Page_Visit', {
                    'page_title': 'Scrambl Word Game',
                    'page_location': window.location.href
                });
            },
            
            // Track game completed
            trackGameCompleted: function(score, wordsSolved) {
                gtag('event', 'Scrambl_Game_Completed', {
                    'event_category': 'Game Actions',
                    'score': score,
                    'words_solved': wordsSolved
                });
            },
            
            // Track share button clicks
            trackShare: function(context, score) {
                gtag('event', 'Scrambl_Score_Shared', {
                    'event_category': 'Game Actions',
                    'share_context': context,
                    'score': score
                });
            }
        };

        // Word list - simplified to array initialization
        const allWords = [
            // 50 three-letter words
    "ACE", "APE", "ART", "BAG", "BAT", "BEE", "BOX", "BUG", "BUS", "CAP", 
    "CAT", "COW", "CUP", "DAY", "DOG", "EAR", "EGG", "EYE", "FAN", "FIN", 
    "FLY", "FOX", "FUN", "GEM", "HAT", "HEN", "ICE", "JAR", "JOY", "KEY", 
    "KID", "LAW", "LEG", "LIP", "MAP", "MUD", "NET", "OWL", "PEN", "PIE", 
    "PIN", "RAT", "RUG", "SKY", "SUN", "TOE", "TOP", "VAN", "WEB", "ZOO",
    
    // 50 four-letter words
    "ABLE", "BABY", "BALL", "BEAR", "BELT", "BIKE", "BIRD", "BOAT", "BOOK", "BOWL", 
    "CAKE", "CARD", "CASH", "CHEF", "COIN", "COOL", "DART", "DESK", "DISH", "DOOR", 
    "DRUM", "DUCK", "FISH", "FLAG", "FROG", "GAME", "GIFT", "GOLD", "HAIR", "HAND", 
    "HERO", "HOOK", "JUMP", "KITE", "LAMP", "LEAF", "MASK", "MOON", "NAIL", "PARK", 
    "PLUG", "RAIN", "RING", "ROCK", "ROPE", "SHIP", "SHOE", "STAR", "TIRE", "TREE",
    
    // 50 five-letter words
    "APPLE", "BEACH", "BREAD", "BRICK", "BRUSH", "CHAIR", "CHEESE", "CLOCK", "CLOUD", "DANCE", 
    "DREAM", "DRESS", "DRINK", "EAGLE", "EARTH", "FLAME", "FLUTE", "GHOST", "GLOBE", "GLOVE", 
    "GRAPE", "GREEN", "HOTEL", "HOUSE", "JEWEL", "KNIFE", "LEMON", "LIGHT", "MAGIC", "MEDAL", 
    "MONEY", "MOUSE", "MUSIC", "OCEAN", "PAINT", "PAPER", "PHONE", "PIANO", "PLANT", "PLATE", 
    "QUEEN", "RIVER", "ROBOT", "SMILE", "SNAKE", "SPACE", "SPOON", "STORM", "TIGER", "WATER",
    
    // 25 six-letter words
    "BANANA", "BUTTON", "CAMERA", "COFFEE", "DRAGON", "FOREST", "GARDEN", "GUITAR", "ISLAND", "JACKET", 
    "LADDER", "MARKET", "MONKEY", "ORANGE", "PENCIL", "POCKET", "ROCKET", "SANDWICH", "SCHOOL", "TICKET", 
    "TURTLE", "VELVET", "WALLET", "WINDOW", "WINTER",
    
    // 25 seven-letter words
    "AIRPLANE", "BICYCLE", "CANDLE", "DIAMOND", "ELEPHANT", "FEATHER", "GATEWAY", "HORIZON", "JOURNEY", "KITCHEN", 
    "LIBRARY", "MORNING", "NECKLACE", "OCTOPUS", "PENGUIN", "RAINBOW", "SHUTTLE", "TEAPOT", "UMBRELLA", "VILLAGE", 
    "WHISTLE", "YOGURT", "ZEBRA", "DOLPHIN", "BLOSSOM"
        ];

        // Game constants and variables
        const GAME_TIME = 30;
        let dailyWords = [], currentWordIndex = 0, currentWord = "", currentScrambled = "";
        let score = 0, wordsSolved = 0, timeLeft = GAME_TIME, gameActive = false, today, timer;

        // Cache DOM elements
        const elements = {
            startScreen: document.getElementById("start-screen"),
            playedToday: document.getElementById("played-today"),
            gamePlay: document.getElementById("game-play"),
            gameOver: document.getElementById("game-over"),
            startButton: document.getElementById("start-game"),
            scrambledWord: document.getElementById("scrambled-word"),
            userGuess: document.getElementById("user-guess"),
            submitBtn: document.getElementById("submit-btn"),
            skipBtn: document.getElementById("skip-btn"),
            message: document.getElementById("message"),
            score: document.getElementById("score"),
            timer: document.getElementById("timer"),
            wordsSolved: document.getElementById("words-solved"),
            countdown: document.getElementById("countdown"),
            countdownEnd: document.getElementById("countdown-end"),
            todayScore: document.getElementById("today-score"),
            dailyDate: document.getElementById("daily-date"),
            shareLink: document.getElementById("share-link"),
            shareLinkPlayed: document.getElementById("share-link-played")
        };

        // Helper functions
        function getCurrentDateCT() {
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        function getTimeUntilMidnightLocal() {
            const now = new Date();
            const midnight = new Date(now);
            midnight.setHours(24, 0, 0, 0);
            return midnight - now;
        }

        function updateCountdown() {
            const msLeft = getTimeUntilMidnightLocal();
            const hoursLeft = Math.floor(msLeft / (1000 * 60 * 60));
            const minutesLeft = Math.floor((msLeft % (1000 * 60 * 60)) / (1000 * 60));
            const countdownText = `Next: ${hoursLeft}h ${minutesLeft}m`;
            elements.countdown.textContent = countdownText;
            elements.countdownEnd.textContent = countdownText;
            if (msLeft <= 0) window.location.reload();
        }

        function seededRandom(seed) {
            let t = seed + 0x6D2B79F5;
            t = Math.imul(t ^ t >>> 15, t | 1);
            t ^= t + Math.imul(t ^ t >>> 7, t | 61);
            return ((t ^ t >>> 14) >>> 0) / 4294967296;
        }

        // Game functions
        function getDailyWords(dateStr) {
            let seed = 0;
            for (let i = 0; i < dateStr.length; i++) seed += dateStr.charCodeAt(i);
            
            const shuffledWords = [...allWords];
            for (let i = shuffledWords.length - 1; i > 0; i--) {
                const j = Math.floor(seededRandom(seed + i) * (i + 1));
                [shuffledWords[i], shuffledWords[j]] = [shuffledWords[j], shuffledWords[i]];
            }
            return shuffledWords.slice(0, 30);
        }

        function scrambleWord(word, dateStr, wordIndex) {
            const wordArray = word.split("");
            let seed = 0;
            for (let i = 0; i < dateStr.length; i++) seed += dateStr.charCodeAt(i);
            seed += wordIndex * 100;

            for (let i = wordArray.length - 1; i > 0; i--) {
                const j = Math.floor(seededRandom(seed + i) * (i + 1));
                [wordArray[i], wordArray[j]] = [wordArray[j], wordArray[i]];
            }

            let scrambled = wordArray.join("");
            if (scrambled === word && wordArray.length >= 2) {
                [wordArray[0], wordArray[1]] = [wordArray[1], wordArray[0]];
                scrambled = wordArray.join("");
            }
            return scrambled;
        }

        function hasPlayedToday() {
            try {
                const playedDate = localStorage.getItem('lastPlayedDate');
                if (!playedDate) return false;
                const playedDateClean = playedDate.split("?")[0];
                const todayClean = today.split("?")[0];
                return playedDateClean === todayClean;
            } catch (error) {
                console.error("Local storage error:", error);
                return false;
            }
        }

        function saveToday(finalScore) {
            try {
                localStorage.setItem('lastPlayedDate', today);
                localStorage.setItem('lastScore', finalScore);
                localStorage.setItem('wordsSolved', wordsSolved);
            } catch (error) {
                console.error("Local storage error:", error);
            }
        }

        function getNextWord() {
            if (currentWordIndex >= dailyWords.length) currentWordIndex = 0;
            currentWord = dailyWords[currentWordIndex];
            currentScrambled = scrambleWord(currentWord, today.split("?")[0], currentWordIndex);
            elements.scrambledWord.textContent = currentScrambled;
            elements.userGuess.value = "";
            elements.message.textContent = "";
            elements.message.className = "";
            elements.userGuess.focus();
        }

        function checkAnswer() {
            if (!gameActive) return;
            const userGuess = elements.userGuess.value.trim().toUpperCase();

            if (userGuess === currentWord) {
                elements.message.textContent = "Correct!";
                elements.message.className = "correct";
                
                const points = currentWord.length * 10;
                score += points;
                wordsSolved++;
                elements.score.textContent = score;
                elements.wordsSolved.textContent = wordsSolved;
                elements.userGuess.value = "";
                currentWordIndex++;
                
                getNextWord();
            } else if (userGuess !== "") {
                elements.message.textContent = "Try again!";
                elements.message.className = "incorrect";
            }
        }

        function skipWord() {
            if (!gameActive) return;
            elements.userGuess.value = "";
            currentWordIndex++;
            getNextWord();
        }

        function updateTimer() {
            elements.timer.textContent = `Time: ${timeLeft}s`;
        }

        function setupShareLink(elementId) {
            const gameLink = window.location.href;
            const currentDate = new Date();
            const options = { weekday: 'long', month: 'short', day: 'numeric' };
            const formattedDate = currentDate.toLocaleDateString('en-US', options);
            const displayScore = elementId === "share-link" ? score : 
                                (localStorage.getItem('lastScore') || "0");
            const shareMessage = `Scrambl ${formattedDate}: ${displayScore} points. ${gameLink}`;
            document.getElementById(elementId).href = `sms:?&body=${encodeURIComponent(shareMessage)}`;
        }

        function endGame() {
            gameActive = false;
            clearInterval(timer);
            document.getElementById("final-score-display").textContent = `${wordsSolved} words | ${score} points`;
            
            setupShareLink("share-link");

            // Track game completed
            analytics.trackGameCompleted(score, wordsSolved);
            
            saveToday(score);
            elements.gamePlay.style.display = "none";
            elements.gameOver.style.display = "block";
            updateCountdown();
            setInterval(updateCountdown, 60000);
        }

        function startGame() {
            if (hasPlayedToday()) return;
            
            // Reset game variables
            currentWordIndex = 0;
            score = 0;
            wordsSolved = 0;
            timeLeft = GAME_TIME;
            gameActive = true;

            elements.score.textContent = score;
            elements.wordsSolved.textContent = wordsSolved;
            updateTimer();

            elements.startScreen.style.display = "none";
            elements.gamePlay.style.display = "block";
            elements.gameOver.style.display = "none";

            getNextWord();

            timer = setInterval(() => {
                timeLeft--;
                updateTimer();
                if (timeLeft <= 0) endGame();
            }, 1000);
        }

        function initGame() {
            const timestamp = new Date().getTime();
            today = getCurrentDateCT() + "?t=" + timestamp;
            
            const now = new Date();
            const options = { weekday: 'long', month: 'short', day: 'numeric' };
            elements.dailyDate.textContent = now.toLocaleDateString('en-US', options);

            const lastPlayedDate = localStorage.getItem('lastPlayedDate');
            if (lastPlayedDate && lastPlayedDate.split("?")[0] !== today.split("?")[0]) {
                localStorage.removeItem('lastPlayedDate');
                localStorage.removeItem('lastScore');
                localStorage.removeItem('wordsSolved');
            }

            dailyWords = getDailyWords(today.split("?")[0]);
            
            // Track page view
            analytics.trackPageView();

            if (hasPlayedToday()) {
                try {
                    const lastScore = localStorage.getItem('lastScore') || "0";
                    const lastWordsSolved = localStorage.getItem('wordsSolved') || "0";
                    elements.todayScore.textContent = `${lastWordsSolved} words | ${lastScore} points`;
                    
                    setupShareLink("share-link-played");
                } catch (error) {
                    console.error("Local storage error:", error);
                }

                elements.startScreen.style.display = "none";
                elements.playedToday.style.display = "block";
                updateCountdown();
                setInterval(updateCountdown, 60000);
            } else {
                elements.startScreen.style.display = "block";
                elements.playedToday.style.display = "none";
            }
        }

        // Event listeners
        elements.startButton.addEventListener("click", startGame);
        elements.submitBtn.addEventListener("click", checkAnswer);
        elements.skipBtn.addEventListener("click", skipWord);
        
        // Share button tracking
        elements.shareLink.addEventListener("click", function() {
            analytics.trackShare("game_completed", score);
        });
        
        elements.shareLinkPlayed.addEventListener("click", function() {
            const lastScore = localStorage.getItem('lastScore') || "0";
            analytics.trackShare("already_played", parseInt(lastScore));
        });

        elements.userGuess.addEventListener("keypress", (e) => {
            if (e.key === "Enter") checkAnswer();
        });

        // Initialize game on page load
        window.addEventListener("DOMContentLoaded", initGame);
    </script>
</body>
</html>
